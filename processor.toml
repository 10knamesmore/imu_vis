# ==========================================
# IMU 数据处理流水线配置文件
# ==========================================

# --- 全局参数 ---
[global]
gravity = 9.953         # 当地重力加速度（m/s²）- 全局使用

# --- 标定模块 ---
# 作用：对原始 acc/gyro 数据进行零偏补偿和矩阵校正
[calibration]
passby = false          # true = 跳过标定，直接透传原始数据（适用于硬件已完成标定的情况）
                        # false = 应用下方的 bias 和 matrix 进行校正
accel_bias = { x = 0.003, y = 0.005, z = 0.012 }    # 加速度计零偏（m/s²）校正公式：accel = raw - bias
gyro_bias = { x = 0.0, y = 0.0, z = 0.0 }     # 陀螺仪零偏（rad/s）
accel_matrix = [        # 加速度计校正矩阵（3x3）
  [1.0, 0.0, 0.0],
  [0.0, 1.0, 0.0],
  [0.0, 0.0, 1.0],
]
gyro_matrix = [         # 陀螺仪校正矩阵（3x3）
  [1.0, 0.0, 0.0],
  [0.0, 1.0, 0.0],
  [0.0, 0.0, 1.0],
]

# --- 低通滤波模块 ---
# 作用：平滑 acc/gyro 数据，降低高频噪声
[filter]
passby = true           # true = 跳过滤波，直接使用标定后的数据
                        # false = 应用低通滤波器
alpha = 0.9             # 滤波系数（0~1），越大越平滑但延迟越高

# 姿态直接使用 IMU 原始四元数（quat），不做额外估计。

# --- 三维轨迹计算模块 ---
# 作用：通过姿态和加速度积分计算世界坐标系中的三维运动轨迹
[trajectory]
passby = false          # true = 跳过轨迹计算，不进行位置推算
                        # false = 启用轨迹计算（注意：长时间会漂移，需配合 ZUPT）

# --- 零速修正模块 (ZUPT) ---
# 作用：检测静止状态并修正速度漂移
[zupt]
passby = false          # true = 跳过零速检测
                        # false = 启用零速修正（适用于挥拍间歇等间歇运动）
gyro_thresh = 0.15      # 陀螺仪静止阈值（rad/s）- 稍放宽以适应握拍轻微晃动
accel_thresh = 0.3      # 加速度静止阈值（m/s²）- 稍放宽以容忍小幅晃动
